# 统一入口使用说明

## 概述

项目现在提供了统一的入口脚本 `random_agent.py`，可以启动所有已注册的任务，无需为每个任务单独编写脚本。

## 快速开始

### 方法 1：直接使用 Python（推荐）

```bash
# 1. 激活conda环境
conda activate env_isaaclab

# 2. 进入项目目录
cd /home/junzhe/IsaacLab-2.2.1/source/isaaclab_logistics_vla

# 3. 运行任务
python random_agent.py --task Isaac-Realman-lift --num_envs 2
```

### 方法 2：使用启动脚本

```bash
# 1. 激活conda环境
conda activate env_isaaclab

# 2. 运行任务（脚本会自动处理路径）
cd /home/junzhe/IsaacLab-2.2.1/source/isaaclab_logistics_vla
./run_task.sh --task Isaac-Realman-lift --num_envs 2
```

### 方法 3：使用 isaaclab.sh（兼容原有方式）

```bash
cd /home/junzhe/IsaacLab-2.2.1
./isaaclab.sh -p source/isaaclab_logistics_vla/random_agent.py --task Isaac-Realman-lift --num_envs 2
```

## 可用任务

- **Isaac-Realman-lift**: Realman机器人抓取任务
- **Isaac-Logistics-SingleArmSorting-Franka-v0**: Franka机器人单臂分拣任务

## 常用参数

### 必需参数

- `--task`: 任务名称（例如：`Isaac-Realman-lift`）

### 可选参数

- `--num_envs`: 环境数量（默认：使用配置中的值）
- `--device`: 设备（`cuda:0`, `cpu`，默认：`cuda:0`）
- `--disable_fabric`: 禁用fabric，使用USD I/O操作
- `--headless`: 无头模式（不显示GUI，服务器上运行必需）
- `--record-video`: 录制视频文件路径（例如：`output.mp4`）。如果指定，将自动启用摄像头
- `--record-duration`: 录制时长（秒），默认10秒

### 完整示例

```bash
# Realman抓取任务，2个环境，使用GPU
python random_agent.py --task Isaac-Realman-lift --num_envs 2 --device cuda:0

# Franka分拣任务，4个环境，无头模式
python random_agent.py --task Isaac-Logistics-SingleArmSorting-Franka-v0 --num_envs 4 --headless

# 使用CPU，禁用fabric
python random_agent.py --task Isaac-Realman-lift --num_envs 1 --device cpu --disable_fabric

# 无头模式 + 录制视频（10秒，默认）
python random_agent.py --task Isaac-Realman-lift --num_envs 2 --headless --record-video output.mp4

# 无头模式 + 录制视频（自定义时长，例如15秒）
python random_agent.py --task Isaac-Realman-lift --num_envs 2 --headless --record-video output.mp4 --record-duration 15.0
```

## 查看所有可用任务

如果输入了错误的任务名称，脚本会自动列出所有可用的Isaac任务：

```bash
python random_agent.py --task WrongTaskName
# 输出会显示所有可用的任务列表
```

## 项目结构

```
isaaclab_logistics_vla/
├── random_agent.py          # 统一入口脚本
├── run_task.sh              # 便捷启动脚本
├── isaaclab_logistics_vla/  # 扩展包源码
│   ├── tasks/               # 任务定义
│   │   ├── realman_lift/    # Realman抓取任务
│   │   └── single_arm_sorting/  # Franka分拣任务
│   └── assets/              # 资源文件
│       └── robots/          # 机器人模型
│           └── realman/     # Realman机器人
└── 使用指南.md              # 详细使用文档
```

## 故障排除

### 1. 任务未找到

**错误信息：**
```
[错误]: 任务 'Isaac-Realman-lift' 未在Gym注册表中找到。
```

**解决方法：**
1. 确保已安装扩展包：
   ```bash
   cd /home/junzhe/IsaacLab-2.2.1
   ./isaaclab.sh -p -m pip install -e source/isaaclab_logistics_vla
   ```

2. 检查任务是否正确注册：
   ```bash
   ./isaaclab.sh -p
   >>> import gymnasium as gym
   >>> import isaaclab_logistics_vla
   >>> "Isaac-Realman-lift" in gym.envs.registry
   ```

### 2. 机器人资源未找到

**错误信息：**
```
找不到文件: .../robots/realman/realman_no_wheel.usd
```

**解决方法：**
确保机器人资源文件存在于：
```
/home/junzhe/IsaacLab-2.2.1/source/isaaclab_logistics_vla/isaaclab_logistics_vla/assets/robots/realman/realman_no_wheel.usd
```

### 3. 导入错误

**错误信息：**
```
ModuleNotFoundError: No module named 'isaaclab_logistics_vla'
```

**解决方法：**
1. 确保在正确的conda环境中：`conda activate env_isaaclab`
2. 重新安装扩展包（使用可编辑模式）：
   ```bash
   ./isaaclab.sh -p -m pip install -e source/isaaclab_logistics_vla
   ```

## 技术细节

### 任务注册机制

所有任务通过以下方式自动注册：

1. **扩展包初始化** (`isaaclab_logistics_vla/__init__.py`):
   - 使用 `import_packages` 自动导入所有子包
   - 触发 `tasks/__init__.py` 的导入

2. **任务包初始化** (`tasks/__init__.py`):
   - 导入所有任务子包（如 `realman_lift`, `single_arm_sorting`）
   - 触发各任务的 `__init__.py` 中的 `gym.register()` 调用

3. **任务注册** (`tasks/realman_lift/__init__.py`):
   - 调用 `gym.register()` 注册环境

### 统一入口脚本工作原理

1. 解析命令行参数
2. 启动 Isaac Sim（通过 `AppLauncher`）
3. 导入 `isaaclab_tasks` 和 `isaaclab_logistics_vla`（触发环境注册）
4. 使用 `parse_env_cfg` 解析环境配置
5. 创建 Gym 环境
6. 运行随机动作循环

## 下一步

- 查看 `使用指南.md` 了解更详细的使用方法
- 查看各任务的配置文件了解如何自定义任务
- 参考 `isaaclab_logistics_vla/tasks/` 下的示例创建新任务

